

<!-- demo链接 -->
<!-- https://bl.ocks.org/d3noob/ced1b9b18bd8192d2c898884033b5529 -->


<!DOCTYPE html>
<meta charset="utf-8">
    <style>
        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }
        body { font: 12px Arial;}
        .legend {
            font-size: 16px;
            font-weight: bold;
            text-anchor: left;
        }
    </style>
    <body>
        <!-- load the d3.js library -->    	
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>
            // set the dimensions and margins of the graph
            var margin = {
                    top: 20, 
                    right: 150, 
                    bottom: 30, 
                    left: 50
                },
                width = 960 - margin.left - margin.right,
                height = 470 - margin.top - margin.bottom;

            // array of curve functions and tites
            var daCurve = {
                "d3Curve":d3.curveCardinal,
                "curveTitle":"curveCardinal"
            }

            // parse the date / time
            var parseTime = d3.timeParse("%d-%b-%y");

            // set the ranges
            var x = d3.scaleTime().range([0, width]);
            var y = d3.scaleLinear().range([height,0]);

            // define the line
            var valueline=d3.line()
                            .curve(d3.curveCatmullRomOpen)
                            .x(function(d) { return x(d.date); })
                            .y(function(d) { return y(d.close); });

            // append the svg obgect to the body of the page
            // appends a 'group' element to 'svg'
            // moves the 'group' element to the top left margin
            var svg = d3.select("body")
                        .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                            .attr("transform",
                                "translate(" + margin.left + "," + margin.top + ")");

            // Get the data
            d3.csv("curve.csv", function(error, data) {
                if (error) throw error;

                // format the data
                data.forEach(function(d) {
                    d.date = parseTime(d.date);
                    d.close = +d.close;
                });

                // set the colour scale
                var color = d3.scaleOrdinal(d3.schemeCategory10);

                // Scale the range of the data
                x.domain(d3.extent(data, function(d) { return d.date; }));
                y.domain(d3.extent(data, function(d) { return d.close; }));
                
                // Add the paths with different curves.
                svg.append("path")
                  .datum(data)
                  .attr("class", "line")
                  .style("stroke", function() { // Add the colours dynamically
                          return daCurve.color = color(daCurve.curveTitle); 
                  })
                  .attr("id", 'tag'+i) // assign ID
                  .attr("d", d3.line()
                               .curve(daCurve.d3Curve)
                               .x(function(d) { return x(d.date); })
                               .y(function(d) { return y(d.close); })
                  )
                //   .on("mouseover",function(){
                //     svg.selectAll('circle').style("display",'block')
                //   })
                //   .on('mouseleave',function(d,i,points){
                //     svg.selectAll('circle').style("display",'none')
                //   })

                // Add the scatterplot
                svg.selectAll("dot")
                    .data(data)
                    .enter().append("circle")
                    .attr("r", 4)
                    .attr("cx", function(d) { return x(d.date); })
                    .attr("cy", function(d) { return y(d.close); })
                    // .attr("display", "none")
                    .on('mouseover',function(d,i,points){
                        var fragment = document.createDocumentFragment()
                        var tmpNode = document.createElement("div")
                        tmpNode.innerHTML = [
                            '<div>TOP5</div>',
                            '<div>A:</div>',
                            '<div>B</div>',
                            '<div>C</div>',
                            '<div>D</div>',
                        ].join('')
                        var div={
                            left: 40,
                            width: 90,
                            background:'#3767bf',
                            color:'#fff'
                        }
                        tmpNode.setAttribute('class','qwerty')
                        tmpNode.setAttribute('style',["padding:10px;position:absolute;top:",parseFloat(points[i].getAttribute('cy'))+margin.top,"px;left:",parseFloat(points[i].getAttribute('cx'))+margin.left+div.left,"px;","background:",div.background,";color:",div.color].join(''))
                        fragment.appendChild(tmpNode)
                        document.body.appendChild(fragment)
                    })
                    .on('mouseleave',function(d,i,points){
                        var old=document.getElementsByClassName('qwerty')[0]
                        old && old.remove()
                    })
                var i=0
                // Add the X Axis
                svg.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

                // Add the Y Axis
                svg.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(y));
                    
                // Add the Legend
                svg.append("text")
                    .attr("x", width+5)  // space legend
                    .attr("y", margin.top + 20 + (i * 20))
                    .attr("class", "legend")    // style the legend
                    .style("fill", function() { 
                        // Add the colours dynamically
                        return daCurve.color = color(daCurve.curveTitle); })
                                                .on("click", function(){
                                                    // Determine if current line is visible 
                                                    var active   = daCurve.active ? false : true,
                                                    newOpacity = active ? 0 : 1; 
                                                    // Hide or show the elements based on the ID
                                                    d3.select("#tag"+i)
                                                        .transition().duration(100) 
                                                        .style("opacity", newOpacity); 
                                                    // Update whether or not the elements are active
                                                    daCurve.active = active;
                                                    })  
                                                .text(daCurve.curveTitle);
                });
</script>
</body>